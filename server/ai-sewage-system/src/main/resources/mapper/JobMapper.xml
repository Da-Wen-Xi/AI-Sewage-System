<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sewage.springboot.mapper.impl.JobMapper">
  
  <!-- 根据工单所属人以及工单状态查询列表 -->
  <select id="selectJobList" resultType="com.sewage.springboot.entity.po.Job" parameterType="com.sewage.springboot.entity.po.Job">
  	select  job.*, 
  	u1.username as creator, u2.username as processor, u3.username as inspector,
  	jt.job_type_name as job_type_name
  	from job
  	left join user as u1 on u1.uid=job.creator_uid 
 	left join user as u2 on u2.uid=job.processor_uid 
 	left join user as u3 on u3.uid=job.inspector_uid 
	left join job_type as jt on job.job_type_id = jt.id
	<where>
		<if test="creatorUid != null">and job.creator_uid = #{creatorUid}</if>
		<if test="processorUid != null">and job.processor_uid = #{processorUid}</if>
		<if test="inspectorUid != null">and job.inspector_uid = #{inspectorUid}</if>
		<if test="status != null and status != ''">and job.status = #{status}</if>
	</where>
	order by create_time desc
  </select>
  
</mapper>
